<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Account</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account.css') }}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/main.css')}}">
</head>
<body>
{% include "components/navbar.html" %}

<div class="account-container">

  <!-- LEFT MENU -->
  <aside class="account-menu">
    <h2>My Account</h2>

    <button onclick="showSection('profile')">Profile</button>
    <button onclick="showSection('orders')">Orders</button>
    <button onclick="showSection('edit-profile')">Edit Profile</button>
    <button onclick="showSection('change-password')">Change Password</button>

    <a href="/logout" class="logout">Logout</a>
  </aside>

  <!-- RIGHT CONTENT -->
  <section class="account-content">

    <!-- PROFILE -->
    <div id="profile" class="section active">
      <h3>Profile</h3>
      <p><strong>Name:</strong> {{ user.name }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Phone:</strong> {{ user.phone }}</p>
      <p><strong>Gender:</strong> {{ user.gender }}</p>
      <p><strong>Address:</strong> {{ user.address }}</p>
    </div>

    <!-- ORDERS -->
    <div id="orders" class="section">
      <h3>My Orders</h3>

      {% if user.orders %}
        {% for order in user.orders %}

          <div class="order-card">

            <h4>Order #{{ order.id }}</h4>

            <p><strong>Status:</strong> {{ order.status|capitalize }}</p>
            <p><strong>Total:</strong> ₹{{ order.total_amount }}</p>
            <p><strong>Payment:</strong> {{ order.payment_method }}</p>

            {% if order.tracking_id %}
              <p><strong>Tracking ID:</strong> {{ order.tracking_id }}</p>
            {% endif %}

            {% if order.expected_delivery %}
              <p><strong>Expected Delivery:</strong>
                {{ order.expected_delivery.strftime("%d %b %Y") }}
              </p>
            {% endif %}

            <!-- PRODUCTS -->
            <div class="order-products-scroll">
              {% for item in order.items %}
                <a href="{{ url_for('product_detail', product_id=item.product_id) }}"
                  class="order-product-card">

                  <div class="order-product-img">
                    <img src="{{ url_for('static', filename='images/' ~ item.product.image_filename) }}">
                  </div>

                  <div class="order-product-info">
                    <h5>{{ item.product_name }}</h5>
                    <p>Size: {{ item.size }}</p>
                    <p>Qty: {{ item.quantity }}</p>
                    <p class="price">₹{{ item.price * item.quantity }}</p>
                  </div>

                </a>
              {% endfor %}
            </div>

          </div>

        {% endfor %}
      {% else %}
        <p>No orders yet.</p>
      {% endif %}
    </div>


    <!-- EDIT PROFILE -->
    <div id="edit-profile" class="section">
      <h3>Edit Profile</h3>

      <form method="POST" action="/account/edit">
        <input type="text" name="name" value="{{ user.name }}" required>

        <select name="gender" required>
          <option {{ 'selected' if user.gender=='Male' }}>Male</option>
          <option {{ 'selected' if user.gender=='Female' }}>Female</option>
          <option {{ 'selected' if user.gender=='Other' }}>Other</option>
        </select>

        <textarea name="address" required>{{ user.address }}</textarea>

        <button type="submit">Save Changes</button>
      </form>
    </div>

    <!-- CHANGE PASSWORD -->
    <div id="change-password" class="section">
      <h3>Change Password</h3>

      <form method="POST" action="/account/change-password">
        <input type="password" name="current_password" placeholder="Current Password" required>
        <input type="password" name="new_password" placeholder="New Password" required>
        <input type="password" name="confirm_password" placeholder="Confirm New Password" required>

        <button type="submit">Update Password</button>
      </form>
    </div>

  </section>

</div>

{% include "components/footer.html" %}
<script src="{{ url_for('static', filename='js/account.js') }}"></script>
</body>
</html>
