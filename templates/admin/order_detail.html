<!DOCTYPE html>
<html>
<head>
  <title>Order #{{ order.id }} – Admin</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>

<section class="page-container">

  <h2 class="page-title">Order #{{ order.id }}</h2>

  <!-- ORDER SUMMARY -->
  <div class="admin-card">
    <p><strong>Date:</strong> {{ order.created_at.strftime('%d %b %Y, %I:%M %p') }}</p>
    <p><strong>Status:</strong> {{ order.status }}</p>
    <p><strong>Payment Method:</strong> {{ order.payment_method }}</p>
    <p><strong>Total Amount:</strong> ₹{{ order.total_amount }}</p>
    <p><strong>Total Items:</strong> {{ total_items }}</p>
  </div>

  <!-- CUSTOMER INFO -->
  <div class="admin-card">
    <h3>Customer Details</h3>
    <p><strong>Name:</strong> {{ order.user.name }}</p>
    <p><strong>Email:</strong> {{ order.user.email }}</p>
    <p><strong>Phone:</strong> {{ order.user.phone }}</p>
  </div>

  <!-- DELIVERY ADDRESS -->
  <div class="admin-card">
    <h3>Delivery Address</h3>
    <p>{{ order.address }}</p>
  </div>

  <!-- ORDER ITEMS -->
  <div class="admin-card">
    <h3>Ordered Items</h3>

    <table class="admin-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Size</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order.items %}
        <tr>
          <td>{{ item.product_name }}</td>
          <td>{{ item.size }}</td>
          <td>{{ item.quantity }}</td>
          <td>₹{{ item.price }}</td>
          <td>₹{{ item.price * item.quantity }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- UPDATE STATUS -->
  <div class="admin-card">
    <h3>Update Order Status</h3>

    <form method="POST" action="{{ url_for('update_order_status', order_id=order.id) }}">
      <select name="status">
        <option {% if order.status == "Placed" %}selected{% endif %}>Placed</option>
        <option {% if order.status == "Processing" %}selected{% endif %}>Processing</option>
        <option {% if order.status == "Shipped" %}selected{% endif %}>Shipped</option>
        <option {% if order.status == "Delivered" %}selected{% endif %}>Delivered</option>
        <option {% if order.status == "Cancelled" %}selected{% endif %}>Cancelled</option>
      </select>

      <label>Tracking ID</label>
      <input type="text" name="tracking_id" value="{{ order.tracking_id or '' }}">

      <label>Expected Delivery Date</label>
      <input type="date" name="expected_delivery"
            value="{{ order.expected_delivery if order.expected_delivery }}">

      <button class="btn-primary">Update</button>
    </form>
  </div>
  <!-- REFUND STATUS -->
  {% if order.refund_status %}
  <div class="admin-card">
    <h3>Refund Details</h3>
    <p><strong>Status:</strong> {{ order.refund_status|capitalize }}</p>
    <p><strong>Amount:</strong> ₹{{ order.refund_amount }}</p>
    <p><strong>Method:</strong> {{ order.refund_method|upper }}</p>

    {% if order.refund_status == "pending" %}
    <form method="POST"
          action="{{ url_for('process_refund_admin', order_id=order.id) }}">
      <button class="btn-danger">
        Process Refund
      </button>
    </form>
    {% endif %}

    {% if order.refund_status == "pending" %}
    <form method="POST" action="{{ url_for('mark_refund_processed', order_id=order.id) }}">
      <button class="btn-success">Mark Refund Processed</button>
    </form>
    {% endif %}
  </div>
  {% endif %}
  <!-- DOWNLOAD INVOICE -->
  {% if order.invoice_file %}
  <a href="{{ url_for('static', filename='invoices/' ~ order.invoice_file) }}"
    class="btn-primary"
    target="_blank">
    Download Invoice
  </a>
  {% endif %}

</section>

</body>
</html>
